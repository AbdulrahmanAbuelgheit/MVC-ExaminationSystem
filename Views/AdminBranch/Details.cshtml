@model DisplayBranchVM

@{
    ViewData["Title"] = "Branch Details";
    Layout = "_AdminLayout";
}

<div class="container my-5">
    <!-- Page Header -->
    <div class="text-center mb-5">
        <h2 class="fw-bold text-primary"><i class="bi bi-diagram-3-fill me-2"></i>Branch Details</h2>
        <hr class="w-25 mx-auto border-3 border-primary opacity-50" />
    </div>

    <!-- Branch Info Card -->
    <div class="card border-0 shadow-sm mb-5">
        <div class="card-body">
            <h3 class="card-title fw-semibold text-secondary">@Model.BranchName</h3>
            <div class="d-flex flex-wrap gap-3 mt-3">
                <span class="badge bg-primary fs-6">Governate: @Model.Governate</span>
                <span class="badge bg-info text-dark fs-6">City: @Model.City</span>
                <span class="badge bg-secondary fs-6">Street: @Model.Street</span>
                <span class="badge bg-warning text-dark fs-6">Telephone: @Model.Tel</span>
                <span class="badge bg-dark fs-6">Manager: @Model.ManagerName</span>
            </div>
        </div>
    </div>




    <!-- Tracks Header + Button -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="text-info"><i class="bi bi-shuffle me-2"></i>Tracks in this Branch</h4>
        <a asp-action="AddTrack" asp-route-id="@Model.BranchID" class="btn btn-outline-primary btn-sm">
            <i class="bi bi-plus-circle me-1"></i> Add Track
        </a>
    </div>

    <!-- Tracks Table -->
    @if (Model.Tracks != null && Model.Tracks.Any())
    {
        <div class="table-responsive shadow-sm">
            <table class="table table-striped align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Name</th>
                        <th>Duration</th>
                        <th>Capacity</th>
                        <th>Track Supervisor</th>
                        <th style="width: 250px;">Actions</th>
                        
                    </tr>
                </thead>
                <tbody>
                    @foreach (var track in Model.Tracks)
                    {
                        <tr>
                            <td>@track.TrackName</td>
                            <td>@track.Duration</td>
                            <td>@track.Capacity</td>
                            <td>@track.Supervisor.Ins.FirstName @track.Supervisor.Ins.LastName</td>
                            <td>
                                <a asp-action="AddInstructor"
                                   asp-controller="AdminBranch"
                                   asp-route-trackId="@track.TrackID"
                                   asp-route-branchId="@Model.BranchID"
                                   class="btn btn-outline-primary btn-sm">
                                    Add Instructor To Track
                                    <i class="bi fa-plus"></i>
                                </a>

                                <a asp-action="RemoveTrack"
                                   asp-controller="AdminBranch"
                                   asp-route-trackId="@track.TrackID"
                                   asp-route-branchId="@Model.BranchID"
                                   class="btn btn-outline-danger btn-sm"
                                   onclick="return confirm('Are you sure?')">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                           
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <p class="text-muted mt-3">This branch has no tracks assigned.</p>
    }

    <div class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="text-info"><i class="bi bi-person-badge me-2"></i>Instructors</h4>
           
        </div>

        <div class="table-responsive shadow-sm">
            @if (Model.Instructors != null && Model.Instructors.Any())
            {
                <table class="table table-bordered align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th style="width: 220px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var ins in Model.Instructors)
                        {
                            <tr>
                                <td>@ins.Ins.FirstName @ins.Ins.LastName</td>
                                <td>@ins.Ins.Email</td>
                                <td>
                                    @if (Model.ManagerID != ins.InsID)
                                    {
                                        <div class="d-flex gap-2">
                                            <form method="post"
                                                  asp-action="AssignManager"
                                                  asp-controller="AdminBranch"
                                                  asp-route-instructorId="@ins.InsID"
                                                  asp-route-branchId="@Model.BranchID"
                                                  onsubmit="return confirm('Assign this instructor as branch manager?')">
                                                <button class="btn btn-outline-success btn-sm">
                                                    <i class="bi bi-check2-circle me-1"></i>Manager
                                                </button>
                                            </form>
                                        </div>
                                    }
                                    else
                                    {
                                        <span class="badge bg-success">
                                            <i class="bi bi-star-fill me-1"></i>Manager
                                        </span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="text-muted mt-3">This branch has no instructors assigned.</p>
            }
        </div>
    </div>


    <!-- Back Button -->
    <a asp-action="Index" class="btn btn-secondary mt-4">
        <i class="bi bi-arrow-left-circle me-1"></i> Back to List
    </a>
</div>
